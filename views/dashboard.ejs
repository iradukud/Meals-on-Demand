<%- include('partials/header') -%>
<%- include('partials/nav') -%>

<main class="w-100 m-auto text-center ">
  <!-- Heading & Image-->
  <img class="mb-2 mt-2" src="/imgs/homePage.png" alt="bookImage" width="100">
  <h1 class="display-5 fw-bold lh-1 mb-5">Dashboard</h1>

  <%#- Recipes the our DB %>
  <% if (typeof recipes!='undefined') { %>
  
  <%#- Filter through the DB recipes by their meal type %>
  <nav aria-label="recipe filter">
    <ul class="pagination justify-content-center">
      <li class="page-item <%= filter=='breakfast'? "active" : "" %>"><a class="page-link" href="/dbRecipes/filter/breakfast">BREAKFAST</a></li>
      <li class="page-item <%= filter=='brunch'? "active" : "" %>"><a class="page-link" href="/dbRecipes/filter/brunch">BRUNCH</a></li>
      <li class="page-item <%= filter=='lunch'? "active" : "" %>"><a class="page-link" href="/dbRecipes/filter/lunch">LUNCH</a></li>
      <li class="page-item <%= filter=='dinner'? "active" : "" %>"><a class="page-link" href="/dbRecipes/filter/dinner">DINNER</a></li>
      <li class="page-item <%= filter=='snack'? "active" : "" %>"><a class="page-link" href="/dbRecipes/filter/snack">SNACK</a></li>
      <li class="page-item <%= filter=='teatime'? "active" : "" %>"><a class="page-link" href="/dbRecipes/filter/teatime">TEATIME</a></li>
    </ul>
  </nav>

  <section class="row mt-5 px-5">
    <%# Calculated the start and end points of the recipes to be looped through %>
    <% const itemStart= page*8 %>
    <% const itemEnd= (page+1)*8 %>

    <%# Loop through 8 recipes and present them %>
    <% for(i=itemStart;i<itemEnd;i++){%>
    <%# Stop loop at last recipe %>
    <% if(i>recipes.length-1){break}%>

    <%# Container for Each recipe %>
    <div class="col-md-3 themed-grid-col mb-3">
      <div class="card shadow-sm">
        <%# Recipe image %>
        <a href="">
          <img class="card-img-top" width="100%" height="300" src="<%= recipes[i]['image'] %>"></img>
        </a>

        <%# Recipe name %>
        <div class="card-body">
          <a href=">">
            <p class="card-text "><%= recipes[i]['name'] %></p>
          </a>
        </div>
      </div>
    </div>
    <%}%>
  </section>
  
  <%# Page navigation %>
    <div class="d-flex justify-content-center mt-5">
      <nav aria-label="Page navigation example">
        <ul class="pagination">
          <%# Previous page %>
          <% if(page!=0){%>
          <li class="page-item">
            <a class="page-link" href="/dbRecipes/page/<%=page%>_<%=filter%>" aria-label="Previous">
              <span aria-hidden="true">&laquo;</span>
              <span class="sr-only">Previous</span>
            </a>
          </li>

          <%# first page %>
          <li class="page-item <%= page==0? "active" : "" %>"><a class="page-link" href="/dashboard">1</a></li>
          <%}%>

          <%# next 3 pages %>
          <%for(navPage=page;navPage<Math.ceil(recipes.length/8);navPage++){%>
          <% if(navPage==page+4){break}%>
          <li class="page-item <%= page==navPage? "active" : "" %>"><a class="page-link" href="/dbRecipes/page/<%=navPage+1%>_<%=filter%>"><%=navPage+1%></a></li>
          <%}%>

        <%# Next page %>
          <%if(page!=Math.ceil(recipes.length/8)){%>
          <li class="page-item">
            <a class="page-link" href="/dbRecipes/page/<%=page+2%>_<%=filter%>" aria-label="Next">
              <span aria-hidden="true">&raquo;</span>
              <span class="sr-only">Next</span>
            </a>
          </li>
          <%}%>
      </ul>
    </nav>
  </div>
    <% } %>
</main>
<%- include('partials/footer') -%>